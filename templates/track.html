<!doctype html>
<html>
<head lang="zh-Hans">
	<title>XLL的物流</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="static/lib/bootstrap/css/bootstrap.min.css">
	<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.7/angular.min.js"></script>
	<!--script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script-->
	<!--script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script-->
</head>
<body>
<!-- {% raw %} -->
<div class="container">
	<!--h3>追踪一个新的包裹</h3-->
	<form role="form" action="/track/add">
		<div class="form-group">
			<label>客户/主要物品:</label>
            <input type="text" name="customer" value="" class="form-control">
		</div>
		<div class="form-group">
			<label>目的地:</label>
			<input type="text" name="destination" value="" class="form-control">
		</div>
		<div class="form-group">
			<label>包裹号:</label>
			<input type="text" name="trackingNumber" value="" class="form-control">
		</div>
		<div class="form-group">
			<label>物流公司:</label>
			<input type="text" name="slug" value="china-ems" class="form-control">china-ems, colissimo, OR la-poste-colissimo
		</div>
		<input type="submit" value="提交" name="btnSubmit" class="btn btn-warning">
	</form><br><br> 

	<div id="as-root"></div>
	<script>
	// (function(e,t,n){
	// 	var r,i=e.getElementsByTagName(t)[0];
	// 	if(e.getElementById(n))return;r=e.createElement(t);
	// 	r.id=n;
	// 	r.src="//apps.aftership.com/all.js";
	// 	i.parentNode.insertBefore(r,i)})(document,"script","aftership-jssdk");
	</script>

	<div ng-app="myApp" ng-controller="myCtrl">
	  <h3>
	  	<div>物流历史({{total}})</div>
	  </h3>
	  <h4 class="text-info">上次更新：{{lastUpdate}} 之前（更新时间多余1分钟时：刷新页面F5可以更新数据，多刷几次）</h4>
	  
	  <table class="table table-striped">
	    <thead>
	      <tr>
	      	<th/>
	        <th>客户/主要物品</th>
	        <th>目的地</th>
	        <th>包裹号</th>
	        <!-- <th>物流公司</th> -->
	        <th>到达?</th>
	        <th>更新时间</th>
	        <th>最新状态</th>
	        <th>登记时间</th>
	      </tr>
	    </thead>
	    <tbody>
	      <tr ng-repeat="courier in couriers">
	        <td>
                <a type="button" class="btn btn-danger btn-xs" href="/track/delete?key={{courier.key}}" style="display: none;">Delete</button><br>
        	</td>
	        <td>{{courier.customer}}</td>
	        <td>{{courier.destination}}</td>
            <td>{{courier.trackingNumber}}&nbsp;&nbsp;<a href="http://m.kuaidi100.com/index_all.html?type=ems&postid={{courier.trackingNumber}}" target="_blank" class="btn btn-warning btn-xs">查询</a></td>
	        <!-- <td>{{courier.slug}}</td> -->
	        <!-- <td>{{courier.arrived}}</td> -->
	        <td ng-if="courier.arrived">
			        <span class="glyphicon glyphicon-ok"></span>
			</td>
			<td ng-if="!courier.arrived">
			        <span class="glyphicon glyphicon-remove"></span>
			</td>
	        <td>{{courier.lastStatusDate}}</td>
	        <td>{{courier.lastStatus}}</td>
	        <td>{{courier.createdDate}}</td>

	      </tr>
	    </tbody>
	  </table>

	  <ul class="pager">
	    <li class="previous"><a href="" ng-click="previous()">上一页</a></li>
	    <li class="next"><a href="" ng-click="next()">下一页</a></li>
	  </ul>
	</div>
</div>
<!-- {% endraw %} -->
<script>
	var app = angular.module('myApp', []);
	app.controller('myCtrl', function($scope, $http) {
		$scope.offset = 0;
		$scope.limit =10;
	    $http({
	        url: "/track/update",
	        method: "GET"
	    });

	    $scope.get = function(){
	    	$http.get("../track/get?offset="+$scope.offset +"&limit="+$scope.limit).success(function (response) {
	    			$scope.couriers = response.records;
	    			$scope.offset = response.offset;
	    			$scope.total = response.total;
	    			$scope.lastUpdate = response.lastUpdate;
	    		});
	    };
	    $scope.get();
		
	    $scope.previous = function(){
	    	newOffset = $scope.offset - $scope.limit ;
	    	if (newOffset <0) return;
	    	$scope.offset = newOffset;
	    	$scope.get();
	    };
	    $scope.next = function(){
	    	newOffset = $scope.offset + $scope.limit;
	    	if (newOffset >= $scope.total)	return;
	    	$scope.offset = newOffset;
	    	$scope.get();
	    };

		// $scope.delete = function(trackingNumber, key){
		//     var result = confirm("Want to delete " + trackingNumber + "?");
		// 	if (result) {
		// 		$http.get("/track/delete?key=" + key);
		// 	}
	 //    };

	});
</script>
</body>
</html>
