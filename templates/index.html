<!doctype html>
<html>
<head lang="zh-Hans">
	<title>XLL的物流</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
	<script src= "http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
	<!--script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script-->
	<!--script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script-->
</head>
<body>
{% raw %}
<div class="container">
	<!--h3>追踪一个新的包裹</h3-->
	<form role="form" action="/add" onsubmit="btnSubmit.disabled = true; return true;">
		<div class="form-group">
			<label>客户/主要物品:</label>
            <input type="text" name="customer" value="" class="form-control">
		</div>
		<div class="form-group">
			<label>目的地:</label>
			<input type="text" name="destination" value="" class="form-control">
		</div>
		<div class="form-group">
			<label>包裹号:</label>
			<input type="text" name="trackingNumber" value="" class="form-control">
		</div>
		<div class="form-group">
			<label>物流公司:</label>
			<input type="text" name="slug" value="china-ems" class="form-control">china-ems, colissimo, OR la-poste-colissimo
		</div>
		<input type="submit" value="提交" name="btnSubmit" class="btn btn-warning">
	</form><br><br> 
	<div id="as-root"></div>
	<script>
	(function(e,t,n){
		var r,i=e.getElementsByTagName(t)[0];
		if(e.getElementById(n))return;r=e.createElement(t);
		r.id=n;
		r.src="//apps.aftership.com/all.js";
		i.parentNode.insertBefore(r,i)})(document,"script","aftership-jssdk");
	</script>

	<div ng-app="myApp" ng-controller="myCtrl">
	  <h3>物流历史({{total}})</h3>
	  <table class="table table-striped">
	    <thead>
	      <tr>
	        <th>客户/主要物品</th>
	        <th>目的地</th>
	        <th>包裹号</th>
	        <th>物流公司</th>
	        <th>录入时间</th>
	      </tr>
	    </thead>
	    <tbody>
	      <tr ng-repeat="courier in couriers">
	        <td>{{courier.customer}}</td>
	        <td>{{courier.destination}}</td>
<!-- 	        <td>
	        	<div class="as-track-button" data-size="small"  data-responsive="false" data-width="250px" data-tracking-number="{{courier.trackingNumber}}" data-slug="{{courier.slug}}">{{courier.trackingNumber}}</div>
	        </td> -->
	        <!--td>{{courier.trackingNumber}}&nbsp;&nbsp;<a href="http://track.aftership.com/china-ems/{{courier.trackingNumber}}" target="_blank" class="btn btn-warning btn-xs">Track</a></td-->
            <td>{{courier.trackingNumber}}&nbsp;&nbsp;<a href="http://m.kuaidi100.com/index_all.html?type=ems&postid={{courier.trackingNumber}}" target="_blank" class="btn btn-warning btn-xs">查询</a></td>
	        <td>{{courier.slug}}</td>
	        <td>{{courier.createdDate}}</td>
            <td>
                <a type="button" class="btn btn-danger btn-xs" href="../delete?key={{courier.key}}">Delete</a><br>
        	</td>
	      </tr>
	    </tbody>
	  </table>

	  <ul class="pager">
	    <li class="previous"><a href="" ng-click="previous()">上一页</a></li>
	    <li class="next"><a href="" ng-click="next()">下一页</a></li>
	  </ul>
	</div>
</div>
{% endraw %}
<script>
	var app = angular.module('myApp', []);
	app.controller('myCtrl', function($scope, $http) {
		$scope.offset = 0;
		$scope.limit =10;
	    $scope.get = function(){
	    	$http.get("../get?offset="+$scope.offset +"&limit="+$scope.limit).success(function (response) {
	    			$scope.couriers = response.records;
	    			$scope.offset = response.offset;
	    			$scope.total = response.total;
	    		});
	    };
	    $scope.get();
	    $scope.previous = function(){
	    	newOffset = $scope.offset - $scope.limit ;
	    	if (newOffset <0) return;
	    	$scope.offset = newOffset;
	    	$scope.get();
	    };
	    $scope.next = function(){
	    	newOffset = $scope.offset + $scope.limit;
	    	if (newOffset >= $scope.total)	return;
	    	$scope.offset = newOffset;
	    	$scope.get();
	    };
	});
</script>
</body>
</html>